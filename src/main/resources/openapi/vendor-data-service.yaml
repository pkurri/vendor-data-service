openapi: 3.0.3
info:
  title: Vendor Data Service API
  version: 1.0.0
  description: |
    Court case data search API with comprehensive nested object support.
    Secured with JWT Bearer tokens from vendor-auth-service.
    Requires scope: vendor.search
  contact:
    name: API Support
    email: api-support@example.com
servers:
  - url: https://api.example.com
    description: Production
  - url: http://localhost:8081
    description: Local Development
security:
  - bearerAuth: []
paths:
  /api/v1/search:
    get:
      summary: Search court cases via query parameters
      description: Search for court case records using name, DOB, SSN last 4, and other filters
      operationId: searchCasesGet
      tags:
        - Search API
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: X-Request-Id
          required: false
          description: Client-generated unique request ID for idempotency (optional)
          schema:
            type: string
        - in: query
          name: name_last
          schema:
            type: string
            maxLength: 30
          description: Last name (uppercase/normalized)
          required: false
        - in: query
          name: name_first
          schema:
            type: string
            maxLength: 20
          description: First name
          required: false
        - in: query
          name: dob
          schema:
            type: string
            format: date
          description: Date of birth (YYYY-MM-DD)
          required: false
        - in: query
          name: ssn_last4
          schema:
            type: string
            pattern: "^[0-9]{4}$"
          description: Last 4 digits of SSN
          required: false
        - in: query
          name: filed_date_from
          schema:
            type: string
            format: date
          description: Filed date from (YYYY-MM-DD)
          required: false
        - in: query
          name: filed_date_to
          schema:
            type: string
            format: date
          description: Filed date to (YYYY-MM-DD)
          required: false
        - in: query
          name: county_codes
          schema:
            type: array
            items:
              type: integer
              minimum: 0
              maximum: 67
          description: County codes (0-67)
          required: false
          style: form
          explode: true
        - in: query
          name: case_type
          schema:
            type: array
            items:
              type: string
          description: Case types to filter
          required: false
          style: form
          explode: true
        - in: query
          name: include_dockets
          schema:
            type: boolean
            default: false
          description: Include docket entries
          required: false
        - in: query
          name: include_charges
          schema:
            type: boolean
            default: false
          description: Include charges
          required: false
        - in: query
          name: include_events
          schema:
            type: boolean
            default: false
          description: Include court events
          required: false
        - in: query
          name: include_defendants
          schema:
            type: boolean
            default: true
          description: Include defendants
          required: false
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number (1-based)
          required: false
        - in: query
          name: page_size
          schema:
            type: integer
            minimum: 1
            maximum: 500
            default: 100
          description: Page size (max 500)
          required: false
        - in: query
          name: sort_by
          schema:
            type: string
          description: Sort field
          required: false
        - in: query
          name: sort_dir
          schema:
            type: string
            enum: [asc, desc]
            default: asc
          description: Sort direction
          required: false
        - in: query
          name: match_mode
          schema:
            type: string
            enum: [loose, exact]
            default: loose
          description: Match mode
          required: false
      responses:
        '200':
          description: Successful search with API envelope
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
        '400':
          description: Bad Request - Invalid parameters or missing search criteria
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Missing or invalid JWT token
        '403':
          description: Forbidden - Insufficient scope (requires vendor.search)
        '409':
          description: Conflict - Duplicate request ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Too Many Requests - Rate limit exceeded
          headers:
            Retry-After:
              schema:
                type: integer
              description: Seconds to wait before retrying
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: Search court cases via JSON body
      description: Search for court case records using JSON request body with all parameters
      operationId: searchCasesPost
      tags:
        - Search API
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: X-Request-Id
          required: false
          description: Client-generated unique request ID for idempotency (optional)
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchRequest'
      responses:
        '200':
          description: Successful search with API envelope
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '409':
          description: Duplicate request ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limit exceeded
          headers:
            Retry-After:
              schema:
                type: integer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token from vendor-auth-service with scope vendor.search
  schemas:
    ErrorResponse:
      type: object
      description: Standard error response
      properties:
        path:
          type: string
          description: Request path
        status:
          type: integer
          description: HTTP status code
        error:
          type: string
          description: Error type
        message:
          type: string
          description: Error message
        errorCode:
          type: string
          description: Application-specific error code
        requestId:
          type: string
          description: Request ID if provided
        timestamp:
          type: string
          format: date-time
          description: Error timestamp
        details:
          type: array
          items:
            type: string
          description: Additional error details
    
    SearchRequest:
      type: object
      description: Search request with all query parameters
      properties:
        name_last:
          type: string
          maxLength: 30
          description: Last name (uppercase/normalized)
        name_first:
          type: string
          maxLength: 20
          description: First name
        dob:
          type: string
          format: date
          description: Date of birth (YYYY-MM-DD)
        ssn_last4:
          type: string
          pattern: "^[0-9]{4}$"
          description: Last 4 digits of SSN
        filed_date_from:
          type: string
          format: date
          description: Filed date from
        filed_date_to:
          type: string
          format: date
          description: Filed date to
        county_codes:
          type: array
          items:
            type: integer
            minimum: 0
            maximum: 67
          description: County codes
        case_type:
          type: array
          items:
            type: string
          description: Case types
        include_dockets:
          type: boolean
          default: false
          description: Include docket entries
        include_charges:
          type: boolean
          default: false
          description: Include charges
        include_events:
          type: boolean
          default: false
          description: Include court events
        include_defendants:
          type: boolean
          default: true
          description: Include defendants
        page:
          type: integer
          minimum: 1
          default: 1
          description: Page number
        page_size:
          type: integer
          minimum: 1
          maximum: 500
          default: 100
          description: Page size
        sort_by:
          type: string
          description: Sort field
        sort_dir:
          type: string
          enum: [asc, desc]
          default: asc
          description: Sort direction
        match_mode:
          type: string
          enum: [loose, exact]
          default: loose
          description: Match mode
        client_request_id:
          type: string
          description: Client request ID
    
    SearchResponse:
      type: object
      description: API response envelope with metadata and case data
      required:
        - api_version
        - generated_at
        - page
        - page_size
        - data
      properties:
        api_version:
          type: string
          description: API version
          example: v1
        client_request_id:
          type: string
          description: Client request ID if provided
        generated_at:
          type: string
          format: date-time
          description: Response generation timestamp
        page:
          type: integer
          description: Current page number
        page_size:
          type: integer
          description: Page size
        total_records_is_estimate:
          type: boolean
          description: Whether total count is estimated
        warnings:
          type: array
          items:
            type: string
          description: Warning messages
        data:
          type: array
          items:
            $ref: '#/components/schemas/CaseRecord'
          description: Array of case records
    
    CaseRecord:
      type: object
      description: Complete case record with all fields
      properties:
        case_id:
          type: string
          maxLength: 50
        case_number:
          type: string
          maxLength: 50
        ucn:
          type: string
          maxLength: 20
        county_id:
          type: integer
          minimum: 0
          maximum: 67
        court_type:
          type: string
          maxLength: 50
        severity_code:
          type: string
          maxLength: 50
        case_type:
          type: string
          maxLength: 40
        case_status_code:
          type: integer
        judge_code:
          type: string
          maxLength: 30
        judge_code_at_disposition:
          type: string
          maxLength: 30
        outstanding_warrant:
          type: boolean
        contested:
          type: boolean
        jury_trial:
          type: boolean
        filed_date:
          type: string
          format: date
        clerk_file_date:
          type: string
          format: date
        reopen_date:
          type: string
          format: date
        last_docket_date:
          type: string
          format: date
        disposition_date:
          type: string
          format: date
        case_system_entry_date:
          type: string
          format: date
        last_name:
          type: string
          maxLength: 30
        first_name:
          type: string
          maxLength: 20
        middle_name:
          type: string
          maxLength: 20
        suffix_code:
          type: string
          maxLength: 1
        name_type_code:
          type: string
          maxLength: 1
        date_of_birth:
          type: string
          format: date
        sex_code:
          type: string
          maxLength: 1
        race_code:
          type: string
          maxLength: 1
        place_of_birth:
          type: string
          maxLength: 60
        date_of_death:
          type: string
          format: date
        country:
          type: string
          maxLength: 2
        ssn:
          type: string
          maxLength: 11
        clerk_case_number:
          type: string
          maxLength: 20
        reopen_reason:
          type: string
          maxLength: 1
        charges:
          type: array
          items:
            $ref: '#/components/schemas/ChargeDto'
        dockets:
          type: array
          items:
            $ref: '#/components/schemas/DocketDto'
        events:
          type: array
          items:
            $ref: '#/components/schemas/EventDto'
        defendants:
          type: array
          items:
            $ref: '#/components/schemas/DefendantDto'
    
    ChargeDto:
      type: object
      description: Charge information
      properties:
        charge_sequence_number:
          type: string
          maxLength: 15
        initial_filing_date:
          type: string
          format: date
        offense_date:
          type: string
          format: date
        initial_fl_statute_number:
          type: string
          maxLength: 14
        initial_fl_statute_description:
          type: string
          maxLength: 60
        prosecution_action_code:
          type: string
          maxLength: 1
        prosecutor_fl_statute_number:
          type: string
          maxLength: 14
        prosecutor_fl_statute_description:
          type: string
          maxLength: 60
        prosecutor_decision_date:
          type: string
          format: date
        court_fl_statute_number:
          type: string
          maxLength: 14
        court_fl_statute_description:
          type: string
          maxLength: 60
        court_decision_date:
          type: string
          format: date
        court_action_code:
          type: string
          maxLength: 1
        d6_date:
          type: string
          format: date
        trial_type_code:
          type: integer
        traffic_disposition_code:
          type: string
          maxLength: 6
        citation_issued_date:
          type: string
          format: date
        citation_number:
          type: string
          maxLength: 20
        defendant_final_plea_code:
          type: integer
        initial_charge_level_code:
          type: string
          maxLength: 1
        initial_charge_degree_code:
          type: string
          maxLength: 1
        prosecutor_charge_level_code:
          type: string
          maxLength: 1
        prosecutor_charge_degree_code:
          type: string
          maxLength: 1
        prosecutor_charge_count:
          type: integer
        court_charge_level_code:
          type: string
          maxLength: 1
        court_charge_degree_code:
          type: string
          maxLength: 1
        sentences:
          type: array
          items:
            $ref: '#/components/schemas/SentenceDto'
    
    SentenceDto:
      type: object
      description: Sentence information
      properties:
        sentence_sequence_number:
          type: string
          maxLength: 15
        sentence_status_code:
          type: integer
        sentence_imposed_date:
          type: string
          format: date
        sentence_effective_date:
          type: string
          format: date
        sentence_code:
          type: integer
        length_of_sentence_confinement:
          type: string
          maxLength: 1
        confinement_type_code:
          type: string
          maxLength: 1
        judge_code_at_sentence:
          type: string
          maxLength: 30
        division:
          type: string
          maxLength: 30
    
    DocketDto:
      type: object
      description: Docket entry information
      properties:
        docket_id:
          type: string
          maxLength: 14
        docket_action_date:
          type: string
          format: date
        docket_code:
          type: string
          maxLength: 20
        standard_docket_code:
          type: integer
        docket_text:
          type: string
          maxLength: 8000
    
    EventDto:
      type: object
      description: Court event information
      properties:
        event_id:
          type: string
          maxLength: 50
        court_appearance_date:
          type: string
          format: date-time
        court_appearance_time:
          type: string
          maxLength: 50
        judge_code:
          type: string
          maxLength: 30
        court_event_description:
          type: string
          maxLength: 40
        standard_court_event_code:
          type: integer
        court_location:
          type: string
          maxLength: 30
        court_room:
          type: string
          maxLength: 6
        prosecutor:
          type: string
          maxLength: 30
        defendant_attorney:
          type: string
          maxLength: 30
        division:
          type: string
          maxLength: 30
    
    DefendantDto:
      type: object
      description: Defendant/party information
      properties:
        party_id:
          type: string
          maxLength: 50
        last_name:
          type: string
          maxLength: 50
        first_name:
          type: string
          maxLength: 50
        middle_name:
          type: string
          maxLength: 50
        dob:
          type: string
          format: date
        sex:
          type: string
          maxLength: 1
        race:
          type: string
          maxLength: 4
        aka:
          type: array
          items:
            type: string
          description: Alias names
