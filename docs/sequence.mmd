---
title: Vendor Data Search - High Level Sequence
---
sequenceDiagram
    autonumber
    participant C as Client (External)
    participant G as API Gateway / Ingress
    participant V as Vendor Data Service (this)
    participant A as Vendor Auth Service (JWT Issuer)
    participant D as Data Providers

    C->>G: HTTPS request /api/v1/search (Bearer JWT)
    G->>V: Forward request (mTLS/TLS)
    Note over V: Validate JWT (issuer/jwks from env)
    V->>A: (optional) Introspect/Fetch JWKs (startup/cache)
    A-->>V: Public keys / token validation OK

    V->>V: Validate input (SSN last4, DoB, Names)
    V->>D: Query providers (parallel)
    D-->>V: Candidate records
    V->>V: Match & scoring (> threshold)
    V-->>G: 200 OK (SearchResponse[])
    G-->>C: 200 OK

    alt Invalid/Expired token
      V-->>G: 401/403
      G-->>C: 401/403
    end
